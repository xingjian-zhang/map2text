# map2text

## Installation

```bash
git clone git@github.com:xingjian-zhang/map2text.git --recursive
```

```bash
pip install -e .
```

(Optional) If you want to use LargeVis, please install the following
dependencies. See [LargeVis](map2text/external/largevis/README.md) for more
details if you want to use it in OSX.

```bash
make map2text/external/largevis/Linux/LargeVis
```

## Datasets

Currently, we have three task datasets.
Please download the corresponding files and put them in the `data/` directory:
[Dropbox
Link](https://www.dropbox.com/scl/fo/79c7obtbw9b6venmzq26b/AAaCZEdteHYiC4aJBwzbpwA?rlkey=68vtihs33b2qi0as041vwaxkx&st=5jh50ebp&dl=0).

### Research Contexts and Ideas

See [xingjian-zhang/massw](https://github.com/xingjian-zhang/massw) for more details.
Files:

- `massw.tsv`: The MASSW dataset [text & split]
- `key_ideas.npz`: The key ideas corresponding to `massw.tsv` [high-dim &
  low-dim embeddings] (generated by OpenAI ada-002 and LargeVis)
- `context.npz`: The context corresponding to `massw.tsv` [high-dim &
  low-dim embeddings] (generated by OpenAI ada-002 and LargeVis)

### Persona

See
[argilla/FinePersonas-v0.1-clustering-100k](https://huggingface.co/datasets/argilla/FinePersonas-v0.1-clustering-100k)
for more details.
Files:

- `persona.tsv`: The FinePersonas dataset [text & split]
- `persona.npz`: The personas corresponding to `persona.tsv` [high-dim &
  low-dim embeddings] (generated by Alibaba-NLP/gte-large-en-v1.5 and UMAP)

### Prompt Log

See [zhaoyingpan/prompt_log_analysis](https://github.com/zhaoyingpan/prompt_log_analysis)
for more details.
Files:

- `prompt_log.tsv`: The prompt log dataset [text & split]
- `prompt_log.npz`: The prompts corresponding to `prompt_log.tsv` [high-dim &
  low-dim embeddings] (generated by OpenAI ada-002 and UMAP)

## Quick Start (Reproduce Experiments)

### Create high-dim and low-dim embeddings (mapping subtask)

```bash
python map2text/quick_start.py map2text/configs/<dataset>/<method_name>_map.yaml
```

Note: This step is time-consuming. Feel free to skip it and use the provided
embeddings in `data/*.npz`.
embeddings in `data/*.npz`.

### Generate new ideas (generation subtask)

```bash
python map2text/quick_start.py map2text/configs/<method_name>_gen.yaml
```

### Evaluate generation results

```bash
python map2text/quick_eval.py out/<dataset>/<method_name>.json \
    --output_file out/<dataset>/<method_name>_evaluation.yaml \
    --metrics bleu,rouge \  # See available metrics below
```

Available metrics:

Lexical metrics:

- `bleu`: BLEU score
- `rouge`: ROUGE score
- `meteor`: METEOR score

Semantic metrics (existing metrics):

- `bertscore`: BERTScore
- `bleurt`: BLEURT score
- `cosine`: Cosine similarity (computed by `multilingual-e5-large-instruct`)

Semantic metrics (proposed metrics):

- `atometric-i`: Atometric for CS research ideas
- `atometric-c`: Atometric for CS research context
- `atometric-p`: Atometric for persona

## Style check

```bash
ruff check
```
